<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAC Debug Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>body { font-family: sans-serif; background-color: #f3f4f6; }</style>
</head>
<body class="p-4 max-w-lg mx-auto">

    <div id="auth-screen" class="bg-white p-6 rounded-lg shadow-lg mt-10">
        <h2 class="text-2xl font-bold text-center text-red-600 mb-4">üîß DEBUG MODE</h2>
        <p class="text-center text-gray-500 mb-4 text-sm">If you click Login and nothing happens, check your API Keys below.</p>
        
        <input type="email" id="email" placeholder="Email" class="w-full p-2 border rounded mb-2">
        <input type="password" id="password" placeholder="Password" class="w-full p-2 border rounded mb-4">
        
        <button id="loginBtn" onclick="tryLogin()" class="w-full bg-red-600 text-white p-2 rounded font-bold">Try Login</button>
        
        <div id="error-box" class="mt-4 p-2 bg-black text-green-400 font-mono text-xs rounded hidden">
            Waiting for errors...
        </div>
    </div>

    <div id="student-dashboard" class="hidden"><h1 class="text-2xl">üë®‚Äçüéì Student: <span id="st-name"></span></h1></div>

    <div id="admin-dashboard" class="hidden"><h1 class="text-2xl text-red-600">üõ°Ô∏è Admin Panel Active</h1></div>

    <script type="module">
        // ERROR TRAPPING
        window.onerror = function(message, source, lineno, colno, error) {
            alert("CRITICAL ERROR:\n" + message);
            document.getElementById("error-box").classList.remove("hidden");
            document.getElementById("error-box").innerText = "Error on Line " + lineno + ": " + message;
        };

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ---------------------------------------------------------
        // PASTE YOUR KEYS CAREFULLY BETWEEN THE BRACKETS
        // ---------------------------------------------------------
        const firebaseConfig = {
          apiKey: "AIzaSyBnv-g-85KNpSmYG0ZN_tfHLR4DsXpDttc",
  authDomain: "attendance-gac-ngp.firebaseapp.com",
  projectId: "attendance-gac-ngp",
  storageBucket: "attendance-gac-ngp.firebasestorage.app",
  messagingSenderId: "772470800474",
  appId: "1:772470800474:web:5bcf5808a57995a8991863"
        };
        // ---------------------------------------------------------

        try {
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            console.log("Firebase initialized successfully");
        } catch (e) {
            alert("FIREBASE CONFIG ERROR: Did you paste your keys? \n" + e.message);
        }

        window.tryLogin = () => {
            const e = document.getElementById("email").value;
            const p = document.getElementById("password").value;
            
            if(!e || !p) { alert("Please enter email and password"); return; }
            
            document.getElementById("loginBtn").innerText = "Logging in...";
            
            signInWithEmailAndPassword(auth, e, p)
            .then((userCredential) => {
                alert("Login Success! Checking Database...");
            })
            .catch((error) => {
                alert("LOGIN FAILED:\n" + error.message);
                document.getElementById("loginBtn").innerText = "Try Login";
            });
        };

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                try {
                    const userDoc = await getDoc(doc(db, "users", user.uid));
                    if (userDoc.exists()) {
                        const data = userDoc.data();
                        alert("Database Connected! Role: " + data.role);
                        document.getElementById("auth-screen").classList.add("hidden");
                        if(data.role === "student") {
                            document.getElementById("student-dashboard").classList.remove("hidden");
                            document.getElementById("st-name").innerText = data.name;
                        } else if (data.role === "admin") {
                            document.getElementById("admin-dashboard").classList.remove("hidden");
                        }
                    } else {
                        alert("Login worked, but User Profile is missing in Database.");
                    }
                } catch(err) {
                    alert("DATABASE ERROR:\n" + err.message);
                }
            }
        });
    </script>
</body>
</html>
